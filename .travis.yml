sudo: required

matrix:
  include:
    - language: python3
  
    addons: 
      firefox: 55.0
  
    apt:
      packages:
      - python-dev
    cache:
      directories:
        - $HOME/.pip-cache/
    
    before_install:
      - sudo apt-get -qq update
      - sudo apt-get -y install python3-pip
      - sudo apt-get install python-virtualenv
      - wget https://github.com/mozilla/geckodriver/releases/download/v0.19.0/geckodriver-v0.19.0-linux64.tar.gz
      - mkdir geckodriver
      - tar -xzf geckodriver-v0.19.0-linux64.tar.gz -C geckodriver
      - export PATH=$PATH:$PWD/geckodriver

    install:
      - virtualenv  -p python3 ../flask_env
      - source ../flask_env/bin/activate
      - pip3 install -r v1/requirements/test.txt --cache-dir $HOME/.pip-cache

    before_script:
      - export DISPLAY=:99.0
      - sh -e /etc/init.d/xvfb start
      - sleep 3

    script:
      - python v1/app/main.py >> log.txt 2>&1  &
      - python backend/app/main.py >> log.txt 2>&1  &
      - nosetests v1/app/tests/test.py -v --with-coverage
      - nosetests backend/app/tests/test_api.py -v --with-coverage
      - python3 -m pyflakes .
      - cd v1/cli
      - python setup.py install
      - cd ..
      - badgeyay -i v1/app/static/uploads/yellow_futuristic.png -n sample/businesspass.png.csv

    after_success:
      - bash <(curl -s https://codecov.io/bash)


    - language: node_js
      node_js:
          - "6"

      dist: trusty

      addons:
        chrome: stable

      cache:
        directories:
          - $HOME/.npm

      env:
        global:
        # See https://git.io/vdao3 for details.
        - JOBS=1

      before_install:
        - npm config set spin false

      script:
        - cd frontend
        - npm run lint:js
        - npm test
